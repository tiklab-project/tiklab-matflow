(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{887:function(e,t,n){"use strict";n.d(t,"a",(function(){return re}));n(279);var r=n(292),a=(n(330),n(326)),i=(n(327),n(329)),o=(n(235),n(236)),l=(n(213),n(212)),c=(n(240),n(241)),u=(n(251),n(253)),f=n(1),s=n.n(f),p=n(58),d=n(9),m=n(915),b=n(917),y=n(664),v=n(289),g=(n(357),n(351)),h=(n(265),n(264)),O=(n(217),n(216)),j=(n(293),n(294)),E=(n(247),n(246)),S=(n(223),n(222));function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var D=function(e){var t=Object(m.a)().t,n=e.visible,r=e.onCancel,a=e.id,i=void 0===a?"":a,u=e.addSelectedRowKeys,p=e.userIDWidthId;e.domainId;var b=A(Object(f.useState)([]),2),y=b[0],v=b[1],g=A(Object(f.useState)([]),2),j=g[0],w=g[1],I=A(Object(f.useState)(10),1)[0],k=A(Object(f.useState)(1),2),D=k[0],x=k[1],C=A(Object(f.useState)(0),2),F=C[0],R=C[1],N={pageParam:{pageSize:I,currentPage:D}},U=A(Object(f.useState)(N),2),L=U[0],T=U[1];Object(f.useEffect)((function(){J(L)}),[L]),Object(f.useEffect)((function(){v(u)}),[u]);var J=function(e){d.Axios.post("user/findUserPage",e).then((function(e){e.code||(R(e.data.totalRecord),w(e.data.dataList))}))},z=function(){T({pageParam:{pageSize:I,currentPage:1}}),v([]),x(1),R(0),r()},K=[{title:t("privilege-role.name"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:t("privilege-role.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:t("privilege-role.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:t("privilege-role.orga"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:t("privilege-role.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){switch(e){case 2:return t("privilege-role.thirdparty");case 1:return t("privilege-role.internal");default:return"--"}}}],M={selectedRowKeys:y,onChange:function(e){v(e)},onSelect:function(e){var t,n="roleUser/deleteRoleUser";y.some((function(t){return t===e.id}))?(t=new FormData).append("id",p[e.id]):(t={role:{id:i},user:{id:e.id}},n="roleUser/createRoleUser"),d.Axios.post(n,t)}};return s.a.createElement(E.a,{title:t("privilege-select-user"),visible:n,onOk:function(){z()},onCancel:z,closable:!1,width:1200,destroyOnClose:!0},s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement(S.a,{layout:"inline",onFinish:function(e){},preserve:!1},s.a.createElement(S.a.Item,{name:"name",label:t("privilege-user")},s.a.createElement(O.a,null)),s.a.createElement(S.a.Item,null,s.a.createElement(l.a,{type:"primary",htmlType:"submit"},t("privilege-search")))))),s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement("div",{style:{width:"100%"}},s.a.createElement(h.a,{columns:K,dataSource:j,rowSelection:M,rowKey:function(e){return e.id},pagination:{current:D,pageSize:I,total:F,onChange:function(e){x(e);var t=P(P({},t),{},{pageParam:{pageSize:I,currentPage:e}});T(t)}}})))))};function x(){return(x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var R=function(e){var t=e.roleDetail,n=Object(m.a)().t,r=C(Object(f.useState)([]),2),a=r[0],i=r[1];Object(f.useEffect)((function(){return u(),function(){return i([])}}),[]);var u=function(){d.Axios.post("/userdir/findAllList").then((function(e){e.code||i(e.data)}))},p=[{title:n("privilege-role.name"),dataIndex:["user","name"]},{title:n("privilege-role.phone"),dataIndex:["user","phone"]},{title:n("privilege-role.email"),dataIndex:["user","email"]},{title:n("privilege-role.type"),dataIndex:["user","userType"],render:function(e){var t=a.findIndex((function(t){return t.id===e}));return t>-1?a[t].name:"--"}},{title:n("privilege-common.action"),key:"action",render:function(e,t){return s.a.createElement(j.b,{size:"middle"},s.a.createElement("a",{onClick:function(){return N(t.id)}},n("privilege-common.delete")))}}],b=C(Object(f.useState)([]),2),y=b[0],v=b[1],g=C(Object(f.useState)(!1),2),E=g[0],S=g[1],w=C(Object(f.useState)([]),2),P=w[0],I=w[1],A=C(Object(f.useState)({}),2),k=A[0],F=A[1];Object(f.useEffect)((function(){t&&R({roleId:t.id})}),[t]);var R=function(e){d.Axios.post("roleUser/findRoleUserList",e).then((function(e){if(!e.code){v(e.data);var t=e.data.map((function(e){return e.user.id})),n=e.data.reduce((function(e,t){return e[t.user.id]=t.id,e}),{});I(t),F(n)}}))},N=function(e){var n=new FormData;n.append("id",e),d.Axios.post("roleUser/deleteRoleUser",n).then((function(e){e.code||R({roleId:t.id})}))};return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.a,{style:{padding:"16px 0"},justify:"space-between"},s.a.createElement(c.a,{span:6},s.a.createElement(O.a,{placeholder:n("privilege-search")+n("privilege-user-and-org"),onPressEnter:function(e){var n=e.target.value;R({roleId:t.id,name:n})}})),s.a.createElement(l.a,{onClick:function(){S(!0)}},"+",n("privilege-add-user"))),s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement(h.a,{columns:p,dataSource:y,rowKey:function(e){return e.id}}))),s.a.createElement(D,x({},e,{visible:E,onCancel:function(){return S(!1),void R({roleId:t.id})},id:t.id,addSelectedRowKeys:P,userIDWidthId:k,userDir:a})))},N=(n(333),n(311));function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||K(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||K(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $=N.a.Group,B=function(e){var t=e.roleDetail;e.group;var n=z(Object(f.useState)([]),2),r=n[0],a=n[1],i=z(Object(f.useState)({}),2),o=i[0],l=i[1],c=z(Object(f.useState)({}),2),u=c[0],p=c[1];Object(f.useEffect)((function(){t&&m()}),[t]);var m=function(){d.Axios.post("/function/findFunctionList",{type:"2"}).then((function(e){if(!e.code){var n=b(e.data);a(n.result),l(n.resultChild),v(t.id,!0,n.result,n.resultChild)}}))},b=function(e){var t=e.map((function(e){return!e.parentFunction&&{value:e.id,label:e.name}})).filter(Boolean),n=e.map((function(e){return e.parentFunction&&e.parentFunction.id&&{value:e.id,label:e.name,parent:e.parentFunction.id}})).filter(Boolean),r=[],a={};return t.forEach((function(e){var t=e.value,i=n.filter((function(e){return e.parent===t}));r.push({value:e.value,label:e.label,indeterminate:!1,checkedList:[],checkAll:!1}),a[e.value]=i})),{result:r,resultChild:a}},y=function(e){var t=e.filter((function(e){return e.function&&e.function.parentFunction})).map((function(e){return{parentID:e.function.parentFunction.id,id:e.function.id}})),n=e.filter((function(e){return!e.function.parentFunction})).map((function(e){return e.function.id})),r={};return n.forEach((function(e){var n=t.map((function(t){if(t.parentID===e)return t.id})).filter(Boolean);r[e]=[].concat(J(n),[e])})),r},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l={roleId:e};d.Axios.post("roleFunction/findRoleFunctionList",l).then((function(e){if(!e.code){var l=y(e.data),c=e.data.reduce((function(e,t){return e[t.function.id]=t.id,e}),{}),u=t?i:o,f=(t?n:r).map((function(e){var t=l[e.value]?l[e.value]:[],n=0===u[e.value].length,r=t.length===u[e.value].length+1&&0!==t.length,a=r?!r:!!t.length&&t.length<u[e.value].length+1;return n&&1===t.length&&(r=!0,a=!1),L(L({},e),{},{checkedList:t,indeterminate:a,checkAll:r})}));p(c),a(f)}}))},g=function(e,t){var n=t,a=r.filter((function(t){return t.value===e}))[0].checkedList,i=n.length<a.length,o=i?h(a,n):h(n,a);if(i)if(a.length>2){var l=o.filter((function(t){return t!==e}));l.map((function(e,t){j(e,t+1===l.length)}))}else{var c=Array.from(new Set(0===n.length?[e].concat(J(o)):o));c.map((function(e,t){j(e,t+1===c.length)}))}else{var u=0===a.length?[e].concat(J(o)):o;u.map((function(e,t){O(e,t+1===u.length)}))}},h=function(e,t){for(var n=[],r=function(r){var a=e[r];t.some((function(e){return e===a}))&&0!==t.length||n.push(a)},a=0;a<e.length;a++)r(a);return n},O=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={role:{id:t.id},function:{id:e}};d.Axios.post("roleFunction/createRoleFunction",r).then((function(e){n&&v(t.id)}))},j=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=u[e],a=new FormData;a.append("id",r),d.Axios.post("roleFunction/deleteRoleFunction",a).then((function(e){n&&v(t.id)}))};return s.a.createElement(s.a.Fragment,null,r.map((function(e){return s.a.createElement("div",{key:e.value},s.a.createElement(N.a,{indeterminate:e.indeterminate,onChange:function(t){return function(e,t){var n=Object.keys(u),r=n.includes(e),a=n.filter((function(t){return o[e].some((function(e){return e.value===t}))})),i=o[e].filter((function(e){if(!a.some((function(t){return t===e.value})))return e})),l=(!r||0!==o[e].length)&&o[e].length===i.length;if(r||(l=!0,i=o[e]),l)n.includes(e)||(i=[].concat(J(i),[{value:e}])),i.length>0?i.map((function(e,t){O(e.value,t+1===i.length)})):O(e,!0);else{if(n.includes(e)){var c=a.map((function(e){return{value:e}}));i=[].concat(J(c),[{value:e}])}i.length>0?i.map((function(e,t){j(e.value,t+1===i.length)})):j(e,!0)}}(e.value)},checked:e.checkAll},e.label),s.a.createElement("br",null),"       ",s.a.createElement($,{options:o[e.value],value:e.checkedList,onChange:function(t){return function(e,t){g(e,t)}(e.value,t)}}))})))};function W(){return(W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var G=g.a.TabPane,q=function(e){var t=e.roleDetailParams,n=Object(m.a)().t;return s.a.createElement("div",{className:"projectRole-detail"},s.a.createElement(g.a,{type:"card",defaultActiveKey:"people"},s.a.createElement(G,{tab:n("privilege-role.people"),key:"people"},s.a.createElement(R,W({},e,{group:t.group,roleDetail:t}))),s.a.createElement(G,{tab:n("privilege-role.promise"),key:"promise"},s.a.createElement(B,W({},e,{group:t.group,roleDetail:t})))))},H=n(672),Q=n(34),V=["group"];function X(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ne=u.a.Option,re=Object(p.b)(Q.a)(Object(p.c)((function(e){var t=Object(m.a)().t,n=e.privilegeProjectRoleStore,p=n.getProjectRoles,g=n.privilegeProjectRole,h=ee(Object(f.useState)(!1),2),O=h[0],j=h[1],E=ee(Object(f.useState)({}),2),S=E[0],w=E[1],P=ee(Object(f.useState)(99),1)[0],I=ee(Object(f.useState)(1),2),A=I[0],k=I[1],D=ee(Object(f.useState)(0),2);D[0];var x=D[1],C=ee(Object(f.useState)({}),2),F=C[0],R=C[1],N={scope:1,pageParam:{pageSize:P,currentPage:A},type:"2"},U=ee(Object(f.useState)(N),2),L=U[0],T=U[1];Object(f.useEffect)((function(){J(L)}),[L]);var J=function(e){d.Axios.post("role/findRolePage",e).then((function(e){if(0===e.code){p(e.data.dataList),x(e.data.totalRecord);var t=e.data.dataList;if("{}"!==JSON.stringify(F)){var n=t.filter((function(e){return e.id===F.id}));R(n.length>0?n[0]:{})}else R(t.length>0?t[0]:{})}}))},z=Object(f.useCallback)((function(){w({}),j(!1),J(L)}),[O]),K=s.a.createElement(o.a,{justify:"space-between"},s.a.createElement(c.a,{span:12},s.a.createElement(u.a,{placeholder:"请选择类型",allowClear:!0,onChange:function(e){if(e)T(Z(Z({},L),{},{group:e}));else{L.group;var t=X(L,V);T(Z({},t))}},style:{width:"100%"}},s.a.createElement(ne,{value:"system"},t("privilege-role.system")),s.a.createElement(ne,{value:"custom"},t("privilege-role.custom")))),s.a.createElement(l.a,{onClick:function(){j(!0)}},"+",t("privilege-role.addRole"))),M=function(e){R(e)},$=s.a.createElement(i.b,{dataSource:g,renderItem:function(e){return s.a.createElement(i.b.Item,{key:e.id,actions:"custom"===e.group?[s.a.createElement(b.a,{onClick:function(){return function(e){w(e),j(!0)}(e)}})]:[]},s.a.createElement("div",{className:"listName",onClick:function(){return M(e)}},e.name))}});return s.a.createElement(H.a,{onSearch:function(e){T({name:e.target.value,pageParam:{pageSize:P,currentPage:1},type:"2"}),k(1)},actions:K,onDetail:M,ListComp:$},s.a.createElement(s.a.Fragment,null,s.a.createElement(a.b,{title:s.a.createElement(v.a,{routes:[{disabled:!0,breadcrumbName:"角色管理 "},{path:"first",breadcrumbName:"角色列表"}]}),bordered:!0,column:1,labelStyle:{width:160}},"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.roleName")},F.name),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:"角色分组"},function(e){switch(e){case"system":return"系统级";case"project":return"项目级";default:return"项目域"}}(F.group)),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.type")},function(e){switch(e){case"1":return t("privilege-role.system");case"2":default:return t("privilege-role.custom")}}(F.type)),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.roleDesc")},F.desc),"{}"===JSON.stringify(F)&&s.a.createElement(a.b.Item,null,s.a.createElement(r.a,{description:s.a.createElement("span",null,"项目角色列表，你需要创建一个")}))),"{}"!==JSON.stringify(F)&&s.a.createElement(q,{roleDetailParams:F})),s.a.createElement(y.a,{visible:O,cancel:z,editData:S,group:"project",urlType:"project"}))})))},902:function(e,t,n){}}]);