(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{179:function(e,t,o){"use strict";o.r(t),function(e){o(388);var r,a=o(387),l=o(49),c=o.n(l),n=(o(266),o(257)),s=o(8),d=o.n(s),i=(o(223),o(222)),u=o(83),p=o.n(u),f=o(1),m=o.n(f),g=o(9),y=o(914),I=o(310),b=o(656),S=o(654),h=o(15),O=o(58),v=o(653),T="D:\\idea\\pipeline\\doublekit-pipeline-ui\\src\\modules\\config\\configDetails\\configDetails.js";function N(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function j(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?N(Object(o),!0).forEach((function(t){d()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):N(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&r(e);var k="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},P=function(e){var t=e.configStore,o=e.giteeStore,r=e.configDataStore,l=e.githubStore,s=e.pipelineStore,d=t.updateConfigure,u=t.findAllConfigure,h=o.code,O=o.getState,N=l.getAccessToken,k=s.pipelineId,P=s.pipelineName,w=r.setIsPrompt,D=r.setData,A=r.data,B=r.codeData,E=r.setCodeData,C=r.formInitialValues,_=r.setFormInitialValues,L=r.setLinuxShellBlock,G=r.setUnitShellBlock,H=r.setMavenShellBlock,F=r.setCodeType,M=r.setOrderShellBlock,V=r.setShellBlock,x=r.mavenShellBlock,J=r.linuxShellBlock,U=r.shellBlock,q=r.orderShellBlock,z=r.unitShellBlock,K=i.a.useForm(),Q=p()(K,1)[0],R=Object(y.a)((function(e){return e.pluginStore})),W=Object(f.useState)(1),X=p()(W,2),Y=X[0],Z=X[1],$=Object(f.useState)(!1),ee=p()($,2),te=ee[0],oe=ee[1],re=Object(v.a)("code"),ae=Object(v.a)("error"),le=Object(g.getUser)().userId;Object(f.useEffect)((function(){return function(){localStorage.removeItem("gitProofId"),localStorage.removeItem("deployProofId"),localStorage.removeItem("codeId"),localStorage.removeItem("testId"),localStorage.removeItem("structureId"),localStorage.removeItem("deployId")}}),[k]),Object(f.useEffect)((function(){R.map((function(e){"gui"===e.id?oe(!0):oe(!1)}))}),[]),Object(f.useEffect)((function(){if(re){var e={code:re,state:1};localStorage.getItem("giteeCode")?h(re).then((function(t){localStorage.setItem("giteeToken",JSON.stringify(t.data)),localStorage.removeItem("giteeCode"),localStorage.removeItem("githubToken"),O(e),window.close()})):localStorage.getItem("githubCode")&&N(re).then((function(t){localStorage.setItem("githubToken",t.data),localStorage.removeItem("githubCode"),localStorage.removeItem("giteeToken"),O(e),window.close()}))}ae&&(O({code:ae,state:1}),window.close())}),[re]),Object(f.useEffect)((function(){if(B&&B.codeType){var e={codeName:C&&C.codeName,codeBranch:C&&C.codeBranch};Object.assign(B,e),E(j({},B))}}),[C,k]);var ce=[1,2,3,4,5,11,21,22,31,32],ne=[];Object(f.useEffect)((function(){k&&u(k).then((function(e){var t=e.data;0===e.code&&(0===t.length?(E(""),D([]),Q.resetFields(),_({}),G(""),H(""),L(""),M("")):(se(t),de(t)))}))}),[k]);var se=function(e){for(var t=0;t<e.length;t++)for(var o=0;o<ce.length;o++){var r=parseInt(e[t].type/10);10*r<ce[o]&&ce[o]<10*(r+1)&&(ce.splice(o,1),o--)}return ce.map((function(e){me(e,"111")}))},de=function(e){for(var t=0;t<e.length;t++){var o=e[t];o.type<6?ie(o):o.type>10&&o.type<20?ue(o):o.type>20&&o.type<30?pe(o):(o.type>30||o.type<40)&&fe(o),D([].concat(ne)),Object.assign(C,o),_(j({},C))}},ie=function(e){var t={codeId:e.codeId,codeType:e.type,codeName:e.codeName,codeBranch:e.codeBranch},o={gitProofName:e.proof&&e.proof.proofName+"("+e.proof.proofType+")",proofName:e.proof&&e.proof.proofName};Object.assign(C,o),localStorage.setItem("codeId",e.codeId),localStorage.setItem("gitProofId",e.proof&&e.proof.proofId),F(e.type),E(t)},ue=function(e){ne.push({dataId:e.testId,title:e.testAlias,dataType:e.type}),localStorage.setItem("testId",e.testId),G("".concat(e.testOrder?e.testOrder:""))},pe=function(e){ne.push({dataId:e.structureId,title:e.structureAlias,dataType:e.type}),localStorage.setItem("structureId",e.structureId),H("".concat(e.structureOrder?e.structureOrder:""))},fe=function(e){ne.push({dataId:e.deployId,title:e.deployAlias,dataType:e.type});var t={dockerProofName:e.proof&&e.proof.proofName+"("+e.proof.proofType+")"};Object.assign(C,t),localStorage.setItem("deployId",e.deployId),localStorage.setItem("deployProofId",e.proof&&e.proof.proofId),M("".concat(e.deployOrder?e.deployOrder:"")),0===e.deployType?L("".concat(e.startShell?e.startShell:"")):V("".concat(e.startShell?e.startShell:""))},me=function(e,t){switch(e){case 11:ge("test");break;case 21:case 22:ge("structure");break;case 31:case 32:ge("deploy");break;default:ge("git")}_(j({},C)),t||w(!0)},ge=function(e){switch(e){case"git":C.codeName=null,C.codeBranch=null,C.proofName=null,C.gitProofName=null,E(""),F(1);break;case"test":C.testOrder=null,G("");break;case"structure":C.structureAddress=null,C.structureOrder=null,H("");break;case"deploy":C.sshPort=null,C.deployAddress=null,C.sshIp=null,C.sourceAddress=null,C.dockerProofName=null,C.startPort=null,C.mappingPort=null,C.startAddress="",C.deployOrder="",L(""),M(""),V("")}},ye=function(e){var t,o,r,a,l,c,s,i,u,p=0;switch(B){case"":t=0;break;default:t=1}A&&A.map((function(e,t){e.dataType>10&&e.dataType<20&&(o=t+2,a=e.title,s=e.dataType),e.dataType>20&&e.dataType<30&&(r=t+2,l=e.title,i=e.dataType),e.dataType>30&&e.dataType<40&&(p=t+2,c=e.title,u=e.dataType)}));var f={configureCreateTime:I.a.moment,user:{id:le},pipeline:{pipelineId:k},pipelineCode:{codeId:localStorage.getItem("codeId"),sort:t,type:B&&B.codeType,codeBranch:e.codeBranch,codeName:e.codeName,proof:{proofId:localStorage.getItem("gitProofId")}},pipelineTest:{testId:localStorage.getItem("testId"),sort:o,testAlias:a,type:s,testOrder:z},pipelineStructure:{structureId:localStorage.getItem("structureId"),sort:r,structureAlias:l,type:i,structureAddress:e.structureAddress,structureOrder:x},pipelineDeploy:{deployId:localStorage.getItem("deployId"),sort:p,deployAlias:c,type:u,deployType:e.deployType,sshIp:0===e.deployType?e.sshIp:null,sshPort:0===e.deployType?e.sshPort:null,deployAddress:0===e.deployType?e.deployAddress:null,sourceAddress:0===e.deployType?e.sourceAddress:null,startShell:0===e.deployType?J:U,startPort:0===e.deployType?e.startPort:null,mappingPort:0===e.deployType?e.mappingPort:null,startAddress:0===e.deployType?e.startAddress:null,deployOrder:0===e.deployType?q:null,proof:{proofId:localStorage.getItem("deployProofId")}}};d(f).then((function(e){w(!1),0!==e.code?n.b.error({content:"配置失败",className:"message"}):n.b.success({content:"配置成功",className:"message"})}))};return m.a.createElement(f.Fragment,{__source:{fileName:T,lineNumber:373,columnNumber:9}},m.a.createElement("div",{className:"config-top",__source:{fileName:T,lineNumber:374,columnNumber:13}},m.a.createElement(S.a,{userId:le,view:Y,setView:Z,setIsPrompt:w,pipelineId:k,pipelineName:P,isBtn:te,__source:{fileName:T,lineNumber:375,columnNumber:17}})),1===Y?m.a.createElement(b.a,{del:me,form:Q,onFinish:ye,__source:{fileName:T,lineNumber:387,columnNumber:21}}):m.a.createElement(a.a,c()({},e,{point:"gui",pluginStore:R,isModalType:!0,extraProps:{pipelineStore:s,configDataStore:r,form:Q,onFinish:ye,del:me},__source:{fileName:T,lineNumber:393,columnNumber:21}})))};k(P,"useForm{[form]}\nuseSelector{pluginStore}\nuseState{[view,setView](1)}\nuseState{[isBtn,setIsBtn](false)}\nuseEffect{}\nuseEffect{}\nuseEffect{}\nuseEffect{}\nuseEffect{}",(function(){return[y.a]}));var w,D,A=Object(h.o)(Object(O.b)("configStore","giteeStore","structureStore","configDataStore","githubStore","pipelineStore")(Object(O.c)(P)));t.default=A,(w="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(w.register(P,"ConfigDetails","D:\\idea\\pipeline\\doublekit-pipeline-ui\\src\\modules\\config\\configDetails\\configDetails.js"),w.register(A,"default","D:\\idea\\pipeline\\doublekit-pipeline-ui\\src\\modules\\config\\configDetails\\configDetails.js")),(D="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&D(e)}.call(this,o(13)(e))}}]);