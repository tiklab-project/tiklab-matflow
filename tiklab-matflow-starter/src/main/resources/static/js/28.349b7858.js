(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{887:function(e,t,r){"use strict";r.d(t,"a",(function(){return ne}));r(279);var n=r(292),a=(r(330),r(327)),i=(r(328),r(329)),o=(r(235),r(236)),l=(r(213),r(212)),c=(r(240),r(241)),u=(r(251),r(253)),f=r(1),s=r.n(f),p=r(58),d=r(9),m=r(915),b=r(917),y=r(664),v=r(289),g=(r(357),r(351)),h=(r(265),r(264)),O=(r(217),r(216)),j=(r(293),r(294)),E=(r(247),r(246)),S=(r(223),r(222));function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,i=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D=function(e){var t=Object(m.a)().t,r=e.visible,n=e.onCancel,a=e.id,i=void 0===a?"":a,u=e.addSelectedRowKeys,p=e.userIDWidthId;e.domainId;var b=A(Object(f.useState)([]),2),y=b[0],v=b[1],g=A(Object(f.useState)([]),2),j=g[0],w=g[1],I=A(Object(f.useState)(10),1)[0],k=A(Object(f.useState)(1),2),D=k[0],x=k[1],C=A(Object(f.useState)(0),2),F=C[0],R=C[1],N={pageParam:{pageSize:I,currentPage:D}},U=A(Object(f.useState)(N),2),L=U[0],T=U[1];Object(f.useEffect)((function(){J(L)}),[L]),Object(f.useEffect)((function(){v(u)}),[u]);var J=function(e){d.Axios.post("user/findUserPage",e).then((function(e){e.code||(R(e.data.totalRecord),w(e.data.dataList))}))},z=function(){T({pageParam:{pageSize:I,currentPage:1}}),v([]),x(1),R(0),n()},K=[{title:t("privilege-role.name"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:t("privilege-role.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:t("privilege-role.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:t("privilege-role.orga"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:t("privilege-role.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){switch(e){case 2:return t("privilege-role.thirdparty");case 1:return t("privilege-role.internal");default:return"--"}}}],M={selectedRowKeys:y,onChange:function(e){v(e)},onSelect:function(e){var t,r="roleUser/deleteRoleUser";y.some((function(t){return t===e.id}))?(t=new FormData).append("id",p[e.id]):(t={role:{id:i},user:{id:e.id}},r="roleUser/createRoleUser"),d.Axios.post(r,t)}};return s.a.createElement(E.a,{title:t("privilege-select-user"),visible:r,onOk:function(){z()},onCancel:z,closable:!1,width:1200,destroyOnClose:!0},s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement(S.a,{layout:"inline",onFinish:function(e){},preserve:!1},s.a.createElement(S.a.Item,{name:"name",label:t("privilege-user")},s.a.createElement(O.a,null)),s.a.createElement(S.a.Item,null,s.a.createElement(l.a,{type:"primary",htmlType:"submit"},t("privilege-search")))))),s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement("div",{style:{width:"100%"}},s.a.createElement(h.a,{columns:K,dataSource:j,rowSelection:M,rowKey:function(e){return e.id},pagination:{current:D,pageSize:I,total:F,onChange:function(e){x(e);var t=P(P({},t),{},{pageParam:{pageSize:I,currentPage:e}});T(t)}}})))))};function x(){return(x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,i=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var R=function(e){var t=e.roleDetail,r=Object(m.a)().t,n=C(Object(f.useState)([]),2),a=n[0],i=n[1];Object(f.useEffect)((function(){return u(),function(){return i([])}}),[]);var u=function(){d.Axios.post("/userdir/findAllList").then((function(e){e.code||i(e.data)}))},p=[{title:r("privilege-role.name"),dataIndex:["user","name"]},{title:r("privilege-role.phone"),dataIndex:["user","phone"]},{title:r("privilege-role.email"),dataIndex:["user","email"]},{title:r("privilege-role.type"),dataIndex:["user","userType"],render:function(e){var t=a.findIndex((function(t){return t.id===e}));return t>-1?a[t].name:"--"}},{title:r("privilege-common.action"),key:"action",render:function(e,t){return s.a.createElement(j.b,{size:"middle"},s.a.createElement("a",{onClick:function(){return N(t.id)}},r("privilege-common.delete")))}}],b=C(Object(f.useState)([]),2),y=b[0],v=b[1],g=C(Object(f.useState)(!1),2),E=g[0],S=g[1],w=C(Object(f.useState)([]),2),P=w[0],I=w[1],A=C(Object(f.useState)({}),2),k=A[0],F=A[1];Object(f.useEffect)((function(){t&&R({roleId:t.id})}),[t]);var R=function(e){d.Axios.post("roleUser/findRoleUserList",e).then((function(e){if(!e.code){v(e.data);var t=e.data.map((function(e){return e.user.id})),r=e.data.reduce((function(e,t){return e[t.user.id]=t.id,e}),{});I(t),F(r)}}))},N=function(e){var r=new FormData;r.append("id",e),d.Axios.post("roleUser/deleteRoleUser",r).then((function(e){e.code||R({roleId:t.id})}))};return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.a,{style:{padding:"16px 0"},justify:"space-between"},s.a.createElement(c.a,{span:6},s.a.createElement(O.a,{placeholder:r("privilege-search")+r("privilege-user-and-org"),onPressEnter:function(e){var r=e.target.value;R({roleId:t.id,name:r})}})),s.a.createElement(l.a,{onClick:function(){S(!0)}},"+",r("privilege-add-user"))),s.a.createElement(o.a,null,s.a.createElement(c.a,{span:24},s.a.createElement(h.a,{columns:p,dataSource:y,rowKey:function(e){return e.id}}))),s.a.createElement(D,x({},e,{visible:E,onCancel:function(){return S(!1),void R({roleId:t.id})},id:t.id,addSelectedRowKeys:P,userIDWidthId:k,userDir:a})))},N=(r(333),r(312));function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){T(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||K(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,i=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw a}}return i}(e,t)||K(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $=N.a.Group,B=function(e){var t=e.roleDetail;e.group;var r=z(Object(f.useState)([]),2),n=r[0],a=r[1],i=z(Object(f.useState)({}),2),o=i[0],l=i[1],c=z(Object(f.useState)({}),2),u=c[0],p=c[1];Object(f.useEffect)((function(){t&&m()}),[t]);var m=function(){d.Axios.post("/function/findFunctionList",{type:"2"}).then((function(e){if(!e.code){var r=b(e.data);a(r.result),l(r.resultChild),v(t.id,!0,r.result,r.resultChild)}}))},b=function(e){var t=e.map((function(e){return!e.parentFunction&&{value:e.id,label:e.name}})).filter(Boolean),r=e.map((function(e){return e.parentFunction&&e.parentFunction.id&&{value:e.id,label:e.name,parent:e.parentFunction.id}})).filter(Boolean),n=[],a={};return t.forEach((function(e){var t=e.value,i=r.filter((function(e){return e.parent===t}));n.push({value:e.value,label:e.label,indeterminate:!1,checkedList:[],checkAll:!1}),a[e.value]=i})),{result:n,resultChild:a}},y=function(e){var t=e.filter((function(e){return e.function&&e.function.parentFunction})).map((function(e){return{parentID:e.function.parentFunction.id,id:e.function.id}})),r=e.filter((function(e){return!e.function.parentFunction})).map((function(e){return e.function.id})),n={};return r.forEach((function(e){var r=t.map((function(t){if(t.parentID===e)return t.id})).filter(Boolean);n[e]=[].concat(J(r),[e])})),n},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l={roleId:e};d.Axios.post("roleFunction/findRoleFunctionList",l).then((function(e){if(!e.code){var l=y(e.data),c=e.data.reduce((function(e,t){return e[t.function.id]=t.id,e}),{}),u=t?i:o,f=(t?r:n).map((function(e){var t=l[e.value]?l[e.value]:[],r=0===u[e.value].length,n=t.length===u[e.value].length+1&&0!==t.length,a=n?!n:!!t.length&&t.length<u[e.value].length+1;return r&&1===t.length&&(n=!0,a=!1),L(L({},e),{},{checkedList:t,indeterminate:a,checkAll:n})}));p(c),a(f)}}))},g=function(e,t){var r=t,a=n.filter((function(t){return t.value===e}))[0].checkedList,i=r.length<a.length,o=i?h(a,r):h(r,a);if(i)if(a.length>2){var l=o.filter((function(t){return t!==e}));l.map((function(e,t){j(e,t+1===l.length)}))}else{var c=Array.from(new Set(0===r.length?[e].concat(J(o)):o));c.map((function(e,t){j(e,t+1===c.length)}))}else{var u=0===a.length?[e].concat(J(o)):o;u.map((function(e,t){O(e,t+1===u.length)}))}},h=function(e,t){for(var r=[],n=function(n){var a=e[n];t.some((function(e){return e===a}))&&0!==t.length||r.push(a)},a=0;a<e.length;a++)n(a);return r},O=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={role:{id:t.id},function:{id:e}};d.Axios.post("roleFunction/createRoleFunction",n).then((function(e){r&&v(t.id)}))},j=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=u[e],a=new FormData;a.append("id",n),d.Axios.post("roleFunction/deleteRoleFunction",a).then((function(e){r&&v(t.id)}))};return s.a.createElement(s.a.Fragment,null,n.map((function(e){return s.a.createElement("div",{key:e.value},s.a.createElement(N.a,{indeterminate:e.indeterminate,onChange:function(t){return function(e,t){var r=Object.keys(u),n=r.includes(e),a=r.filter((function(t){return o[e].some((function(e){return e.value===t}))})),i=o[e].filter((function(e){if(!a.some((function(t){return t===e.value})))return e})),l=(!n||0!==o[e].length)&&o[e].length===i.length;if(n||(l=!0,i=o[e]),l)r.includes(e)||(i=[].concat(J(i),[{value:e}])),i.length>0?i.map((function(e,t){O(e.value,t+1===i.length)})):O(e,!0);else{if(r.includes(e)){var c=a.map((function(e){return{value:e}}));i=[].concat(J(c),[{value:e}])}i.length>0?i.map((function(e,t){j(e.value,t+1===i.length)})):j(e,!0)}}(e.value)},checked:e.checkAll},e.label),s.a.createElement("br",null),"       ",s.a.createElement($,{options:o[e.value],value:e.checkedList,onChange:function(t){return function(e,t){g(e,t)}(e.value,t)}}))})))};function W(){return(W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var G=g.a.TabPane,q=function(e){var t=e.roleDetailParams,r=Object(m.a)().t;return s.a.createElement("div",{className:"projectRole-detail"},s.a.createElement(g.a,{type:"card",defaultActiveKey:"people"},s.a.createElement(G,{tab:r("privilege-role.people"),key:"people"},s.a.createElement(R,W({},e,{group:t.group,roleDetail:t}))),s.a.createElement(G,{tab:r("privilege-role.promise"),key:"promise"},s.a.createElement(B,W({},e,{group:t.group,roleDetail:t})))))},H=r(672),Q=r(34),V=["group"];function X(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,i=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var re=u.a.Option,ne=Object(p.b)(Q.a)(Object(p.c)((function(e){var t=Object(m.a)().t,r=e.privilegeProjectRoleStore,p=r.getProjectRoles,g=r.privilegeProjectRole,h=ee(Object(f.useState)(!1),2),O=h[0],j=h[1],E=ee(Object(f.useState)({}),2),S=E[0],w=E[1],P=ee(Object(f.useState)(99),1)[0],I=ee(Object(f.useState)(1),2),A=I[0],k=I[1],D=ee(Object(f.useState)(0),2);D[0];var x=D[1],C=ee(Object(f.useState)({}),2),F=C[0],R=C[1],N={scope:1,pageParam:{pageSize:P,currentPage:A},type:"2"},U=ee(Object(f.useState)(N),2),L=U[0],T=U[1];Object(f.useEffect)((function(){J(L)}),[L]);var J=function(e){d.Axios.post("role/findRolePage",e).then((function(e){if(0===e.code){p(e.data.dataList),x(e.data.totalRecord);var t=e.data.dataList;if("{}"!==JSON.stringify(F)){var r=t.filter((function(e){return e.id===F.id}));R(r.length>0?r[0]:{})}else R(t.length>0?t[0]:{})}}))},z=Object(f.useCallback)((function(){w({}),j(!1),J(L)}),[O]),K=s.a.createElement(o.a,{justify:"space-between"},s.a.createElement(c.a,{span:12},s.a.createElement(u.a,{placeholder:"请选择类型",allowClear:!0,onChange:function(e){if(e)T(Z(Z({},L),{},{group:e}));else{L.group;var t=X(L,V);T(Z({},t))}},style:{width:"100%"}},s.a.createElement(re,{value:"system"},t("privilege-role.system")),s.a.createElement(re,{value:"custom"},t("privilege-role.custom")))),s.a.createElement(l.a,{onClick:function(){j(!0)}},"+",t("privilege-role.addRole"))),M=function(e){R(e)},$=s.a.createElement(i.b,{dataSource:g,renderItem:function(e){return s.a.createElement(i.b.Item,{key:e.id,actions:"project"===e.group?[s.a.createElement(b.a,{onClick:function(){return function(e){w(e),j(!0)}(e)}})]:[]},s.a.createElement("div",{className:"listName",onClick:function(){return M(e)}},e.name))}});return s.a.createElement(H.a,{onSearch:function(e){T({name:e.target.value,pageParam:{pageSize:P,currentPage:1},type:"2"}),k(1)},actions:K,onDetail:M,ListComp:$},s.a.createElement(s.a.Fragment,null,s.a.createElement(a.b,{title:s.a.createElement(v.a,{routes:[{disabled:!0,breadcrumbName:"角色管理 "},{path:"first",breadcrumbName:"角色列表"}]}),bordered:!0,column:1,labelStyle:{width:160}},"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.roleName")},F.name),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:"角色分组"},function(e){switch(e){case"system":return"系统级";case"project":return"项目级";default:return"项目域"}}(F.group)),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.type")},function(e){switch(e){case"1":return t("privilege-role.system");case"2":default:return t("privilege-role.custom")}}(F.type)),"{}"!==JSON.stringify(F)&&s.a.createElement(a.b.Item,{label:t("privilege-role.roleDesc")},F.desc),"{}"===JSON.stringify(F)&&s.a.createElement(a.b.Item,null,s.a.createElement(n.a,{description:s.a.createElement("span",null,"项目角色列表，你需要创建一个")}))),"{}"!==JSON.stringify(F)&&s.a.createElement(q,{roleDetailParams:F})),s.a.createElement(y.a,{visible:O,cancel:z,editData:S,group:"project",urlType:"project"}))})))},902:function(e,t,r){}}]);