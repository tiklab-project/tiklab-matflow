(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{886:function(e,t,n){"use strict";n.d(t,"a",(function(){return Q}));n(279);var r=n(292),a=(n(330),n(327)),i=(n(293),n(294)),o=(n(213),n(212)),l=n(1),u=n.n(l),c=n(58),f=n(915),s=n(9),d=n(289),p=n(664),m=(n(357),n(351)),b=(n(265),n(264)),v=(n(235),n(236)),g=(n(240),n(241)),y=(n(217),n(216)),h=(n(247),n(246)),O=(n(223),n(222));function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I=function(e){var t=Object(f.a)().t,n=e.visible,r=e.onCancel,a=e.id,i=void 0===a?"":a,c=e.addSelectedRowKeys,d=e.userIDWidthId,p=e.userDir,m=w(Object(l.useState)([]),2),j=m[0],E=m[1],A=w(Object(l.useState)([]),2),I=A[0],P=A[1],D=w(Object(l.useState)(10),1)[0],k=w(Object(l.useState)(1),2),x=k[0],F=k[1],C=w(Object(l.useState)(0),2),R=C[0],U=C[1],L=w(Object(l.useState)({pageParam:{pageSize:D,currentPage:x}}),2),N=L[0],T=L[1];Object(l.useEffect)((function(){J(N)}),[N]),Object(l.useEffect)((function(){E(c)}),[c]);var J=function(e){s.Axios.post("user/findUserPage",e).then((function(e){e.code||(U(e.data.totalRecord),P(e.data.dataList))}))},z=function(){T({pageParam:{pageSize:D,currentPage:1}}),E([]),F(1),U(0),r()},K=[{title:t("privilege-role.name"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:t("privilege-role.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:t("privilege-role.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:t("privilege-role.org"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:t("privilege-role.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){var t=p.findIndex((function(t){return t.id==e}));return t>-1?p[t].name:"--"}}],B={selectedRowKeys:j,onChange:function(e){E(e)},onSelect:function(e){var t,n="roleUser/deleteRoleUser";j.some((function(t){return t===e.id}))?(t=new FormData).append("id",d[e.id]):(t={role:{id:i},user:{id:e.id}},n="roleUser/createRoleUser"),s.Axios.post(n,t)}};return u.a.createElement(h.a,{title:t("privilege-select-user"),visible:n,onOk:function(){z()},onCancel:z,closable:!1,width:1200},u.a.createElement(v.a,{style:{paddingBottom:16}},u.a.createElement(g.a,{span:24},u.a.createElement(O.a,{layout:"inline",onFinish:function(e){var t=e.name,n=S(S({},N),{},{name:t,pageParam:{pageSize:D,currentPage:1}});T(n)}},u.a.createElement(O.a.Item,{name:"name",label:t("privilege-user")},u.a.createElement(y.a,null)),u.a.createElement(O.a.Item,null,u.a.createElement(o.a,{type:"primary",htmlType:"submit"},t("privilege-search")))))),u.a.createElement(v.a,null,u.a.createElement(g.a,{span:24},u.a.createElement("div",{style:{width:"100%"}},u.a.createElement(b.a,{columns:K,dataSource:I,rowSelection:B,rowKey:function(e){return e.id},pagination:{current:x,pageSize:D,total:R,onChange:function(e){F(e);var t=S(S({},t),{},{pageParam:{pageSize:D,currentPage:e}});T(t)}}})))))};function P(){return(P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var x=function(e){var t=e.roleDetail,n=Object(f.a)().t,r=D(Object(l.useState)([]),2),a=r[0],c=r[1];Object(l.useEffect)((function(){return d(),function(){return c([])}}),[]);var d=function(){s.Axios.post("/userdir/findAllList").then((function(e){e.code||c(e.data)}))},p=[{title:n("privilege-role.name"),dataIndex:["user","name"]},{title:n("privilege-role.phone"),dataIndex:["user","phone"]},{title:n("privilege-role.email"),dataIndex:["user","email"]},{title:n("privilege-role.type"),dataIndex:["user","userType"],render:function(e){var t=a.findIndex((function(t){return t.id==e}));return t>-1?a[t].name:"--"}},{title:n("privilege-common.action"),key:"action",render:function(e,t){return u.a.createElement(i.b,{size:"middle"},u.a.createElement("a",{onClick:function(){return U(t.id)}},n("privilege-common.delete")))}}],m=D(Object(l.useState)([]),2),h=m[0],O=m[1],j=D(Object(l.useState)(!1),2),S=j[0],E=j[1],w=D(Object(l.useState)([]),2),A=w[0],k=w[1],x=D(Object(l.useState)({}),2),F=x[0],C=x[1];Object(l.useEffect)((function(){t&&R({roleId:t.id})}),[t]);var R=function(e){s.Axios.post("roleUser/findRoleUserList",e).then((function(e){if(!e.code){O(e.data);var t=e.data.map((function(e){return e.user.id})),n=e.data.reduce((function(e,t){return e[t.user.id]=t.id,e}),{});k(t),C(n)}}))},U=function(e){var n=new FormData;n.append("id",e),s.Axios.post("roleUser/deleteRoleUser",n).then((function(e){e.code||R({roleId:t.id})}))};return u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,{style:{padding:"16px 0"},justify:"space-between"},u.a.createElement(g.a,{span:6},u.a.createElement(y.a,{placeholder:n("privilege-search")+n("privilege-user-and-org"),onPressEnter:function(e){var n=e.target.value;R({roleId:t.id,name:n})}})),u.a.createElement(o.a,{onClick:function(){E(!0)}},"+",n("privilege-add-user"))),u.a.createElement(v.a,null,u.a.createElement(g.a,{span:24},u.a.createElement(b.a,{columns:p,dataSource:h,rowKey:function(e){return e.id}}))),u.a.createElement(I,P({},e,{visible:S,onCancel:function(){return E(!1),void R({roleId:t.id})},id:t.id,addSelectedRowKeys:A,userIDWidthId:F,userDir:a})))},F=(n(333),n(312));function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){U(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){return function(e){if(Array.isArray(e))return J(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var z=F.a.Group,K=function(e){var t=e.roleDetail,n=e.group,r=N(Object(l.useState)([]),2),a=r[0],i=r[1],o=N(Object(l.useState)({}),2),c=o[0],f=o[1],d=N(Object(l.useState)({}),2),p=d[0],m=d[1];Object(l.useEffect)((function(){t&&b()}),[t]);var b=function(){s.Axios.post("/function/findFunctionList",{group:n}).then((function(e){if(!e.code){var n=v(e.data);i(n.result),f(n.resultChild),y(t.id,!0,n.result,n.resultChild)}}))},v=function(e){var t=e.map((function(e){return!e.parentFunction&&{value:e.id,label:e.name}})).filter(Boolean),n=e.map((function(e){return e.parentFunction&&e.parentFunction.id&&{value:e.id,label:e.name,parent:e.parentFunction.id}})).filter(Boolean),r=[],a={};return t.forEach((function(e){var t=e.value,i=n.filter((function(e){return e.parent===t}));r.push({value:e.value,label:e.label,indeterminate:!1,checkedList:[],checkAll:!1}),a[e.value]=i})),{result:r,resultChild:a}},g=function(e){var t=e.filter((function(e){return e.function&&e.function.parentFunction})).map((function(e){return{parentID:e.function.parentFunction.id,id:e.function.id}})),n=e.filter((function(e){return!e.function.parentFunction})).map((function(e){return e.function.id})),r={};return n.forEach((function(e){var n=t.map((function(t){if(t.parentID===e)return t.id})).filter(Boolean);r[e]=[].concat(L(n),[e])})),r},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={roleId:e};s.Axios.post("roleFunction/findRoleFunctionList",o).then((function(e){if(!e.code){var o=g(e.data),l=e.data.reduce((function(e,t){return e[t.function.id]=t.id,e}),{}),u=t?r:c,f=(t?n:a).map((function(e){var t=o[e.value]?o[e.value]:[],n=0===u[e.value].length,r=t.length===u[e.value].length+1&&0!==t.length,a=r?!r:!!t.length&&t.length<u[e.value].length+1;return n&&1===t.length&&(r=!0,a=!1),R(R({},e),{},{checkedList:t,indeterminate:a,checkAll:r})}));m(l),i(f)}}))},h=function(e,t){var n=t,r=a.filter((function(t){return t.value===e}))[0].checkedList,i=n.length<r.length,o=i?O(r,n):O(n,r);if(i)if(r.length>2){var l=o.filter((function(t){return t!==e}));l.map((function(e,t){S(e,t+1===l.length)}))}else{var u=Array.from(new Set(0===n.length?[e].concat(L(o)):o));u.map((function(e,t){S(e,t+1===u.length)}))}else{var c=0===r.length?[e].concat(L(o)):o;c.map((function(e,t){j(e,t+1===c.length)}))}},O=function(e,t){for(var n=[],r=function(r){var a=e[r];t.some((function(e){return e===a}))&&0!==t.length||n.push(a)},a=0;a<e.length;a++)r(a);return n},j=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={role:{id:t.id},function:{id:e}};s.Axios.post("roleFunction/createRoleFunction",r).then((function(e){n&&y(t.id)}))},S=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=p[e],a=new FormData;a.append("id",r),s.Axios.post("roleFunction/deleteRoleFunction",a).then((function(e){n&&y(t.id)}))};return u.a.createElement(u.a.Fragment,null,a.map((function(e){return u.a.createElement("div",{key:e.value},u.a.createElement(F.a,{indeterminate:e.indeterminate,onChange:function(t){return function(e,t){var n=Object.keys(p),r=n.includes(e),a=n.filter((function(t){return c[e].some((function(e){return e.value===t}))})),i=c[e].filter((function(e){if(!a.some((function(t){return t===e.value})))return e})),o=(!r||0!==c[e].length)&&c[e].length===i.length;if(r||(o=!0,i=c[e]),o)n.includes(e)||(i=[].concat(L(i),[{value:e}])),i.length>0?i.map((function(e,t){j(e.value,t+1===i.length)})):j(e,!0);else{if(n.includes(e)){var l=a.map((function(e){return{value:e}}));i=[].concat(L(l),[{value:e}])}i.length>0?i.map((function(e,t){S(e.value,t+1===i.length)})):S(e,!0)}}(e.value)},checked:e.checkAll},e.label),u.a.createElement("br",null),"       ",u.a.createElement(z,{options:c[e.value],value:e.checkedList,onChange:function(t){return function(e,t){h(e,t)}(e.value,t)}}))})))};function B(){return(B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var M=m.a.TabPane,$=function(e){var t=e.roleDetailParams,n=Object(f.a)().t;return u.a.createElement("div",{className:"role-detail"},u.a.createElement(m.a,{type:"card",defaultActiveKey:"people"},u.a.createElement(M,{tab:n("privilege-role.people"),key:"people"},u.a.createElement(x,B({},e,{group:t.group,roleDetail:t}))),u.a.createElement(M,{tab:n("privilege-role.promise"),key:"promise"},u.a.createElement(K,B({},e,{group:t.group,roleDetail:t})))))},W=n(672),G=n(32);function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Q=Object(c.b)(G.a)(Object(c.c)((function(e){var t=Object(f.a)().t,n=e.systemRoleStore,c=n.getRoles,m=n.privilegeSystemRole,b=q(Object(l.useState)(!1),2),v=b[0],g=b[1],y=q(Object(l.useState)({}),2),h=y[0],O=y[1],j=q(Object(l.useState)(99),1)[0],S=q(Object(l.useState)(1),2),E=S[0],w=S[1],A=q(Object(l.useState)(0),2);A[0];var I=A[1],P=q(Object(l.useState)(""),2),D=P[0],k=P[1],x=q(Object(l.useState)({}),2),F=x[0],C=x[1],R={pageParam:{pageSize:j,currentPage:E}},U=q(Object(l.useState)(R),2),L=U[0],N=U[1];Object(l.useEffect)((function(){T(L)}),[L]);var T=function(e){s.Axios.post("role/findRolePage",e).then((function(e){if(!e.code){c(e.data.dataList),I(e.data.totalRecord);var t=e.data.dataList;if("{}"!==JSON.stringify(F)){var n=t.filter((function(e){return e.id===F.id}));C(n.length>0?n[0]:{})}else C(t.length>0?t[0]:{})}}))},J=Object(l.useCallback)((function(){O({}),g(!1),T(L)}),[v]),z=u.a.createElement(i.b,null,!1,u.a.createElement(o.a,{onClick:function(){return k("custom"),void g(!0)}},"+",t("privilege-role.addRole")));return u.a.createElement(W.a,{onSearch:function(e){N({name:e.target.value,pageParam:{pageSize:j,currentPage:1}}),w(1)},actions:z,onEdit:function(e){O(e),g(!0)},onDelete:function(e){var t=new FormData;t.append("id",e),s.Axios.post("role/deleteRole",t).then((function(e){e.code||T(L)}))},onDetail:function(e){C(e)},data:m,userProduction:!1},u.a.createElement(u.a.Fragment,null,u.a.createElement(a.b,{title:u.a.createElement(d.a,{routes:[{disabled:!0,breadcrumbName:"角色管理 "},{path:"first",breadcrumbName:"角色列表"}]}),bordered:!0,column:1,labelStyle:{width:160}},"{}"!==JSON.stringify(F)&&u.a.createElement(a.b.Item,{label:t("privilege-role.roleName")},F.name),"{}"!==JSON.stringify(F)&&u.a.createElement(a.b.Item,{label:t("privilege-role.type")},function(e){switch(e){case"1":return t("privilege-role.system");case"2":default:return t("privilege-role.custom")}}(F.type)),"{}"!==JSON.stringify(F)&&u.a.createElement(a.b.Item,{label:"角色分组"},function(e){switch(e){case"system":return"系统级";case"custom":return"项目级";default:return"项目域"}}(F.group)),"{}"!==JSON.stringify(F)&&u.a.createElement(a.b.Item,{label:t("privilege-role.roleDesc")},F.desc),"{}"===JSON.stringify(F)&&u.a.createElement(a.b.Item,null,u.a.createElement(r.a,{description:u.a.createElement("span",null,"角色列表，你需要创建一个")}))),"{}"!==JSON.stringify(F)&&u.a.createElement($,{roleDetailParams:F})),u.a.createElement(p.a,{visible:v,cancel:J,editData:h,group:D,urlType:"system"}))})))},901:function(e,t,n){}}]);